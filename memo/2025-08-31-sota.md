# SOTA更新ログ (2025-08-31)

## 概要
- 対象: SPARC `*_rotmod.dat`（Zenodo 2025-07-22公開アーカイブ）。
- 実装: `src/fdb/` に GR(noDM) と FDB3 を実装、
  最小二乗で銀河ごとに当てはめ。行幅<=80桁準拠。
- 実行: `make setup && make fit`（単体）、
  全銀河は `PYTHONPATH=. .venv/bin/python \
  scripts/fit_sparc_fdb3_all.py`。

## 主結果（175銀河）
- 改善倍率(= redχ²_GR / redχ²_FDB3):
  - 中央値: ×19.64
  - 平均値: ×51.45
- 代表例:
  - NGC3198: GR 241.81 → FDB3 11.45（×21.1）
  - NGC2403: GR 1173.01 → FDB3 49.61（×23.7）

注記: 一部銀河で FDB3 が悪化するケースあり（改良余地）。

### 全銀河共同フィット（共有a,b,c）
- 実装: `src/fdb/global_fit.py`, `scripts/global_fit_fdb3.py`
- 弱事前: RJ風のL2拘束（単銀河初期推定の中央値±幅）
- 結果（175銀河, 共有a,b,c）
  - 合成redχ²: GR=195.82 → FDB3=25.90（×7.56）
  - 共有パラメータ: a=563.42, b=0.65, c=3.00
  - 各銀河の(M/L)は個別最適化

### 図（2025-08-31再生成）
- 改善倍率ヒストグラム: `assets/figures/sota_improvement_hist.png`
- redχ²散布図: `assets/figures/sota_redchi2_scatter.png`
- 代表VRパネル(DDO154, DDO161, NGC3198, NGC2403, 他):
  `assets/figures/sota_vr_panel.png`

DDO154/DDO161の中心付近でVが0に張り付く現象は再現せず。
詳細は `memo/vr_center_issue.md` を参照。

## モデル/同定の要点
- 用語: FDB = Future Decoherence Bias（ULW-EM に由来する見かけ重力）。
  FDB3 はその3パラメータ型、FDBL は3D拡張型の略称。
- GR(noDM): `V^2 = Vgas^2 + (M/L)_d Vdisk^2 + (M/L)_b Vbul^2`。
  - 推定パラメータ: `(M/L)_d, (M/L)_b`。
- FDB3: `V^2 = V_baryon^2 + r * a * (1-exp(-r/b))^c`。
  - 推定パラメータ: `a, b, c, (M/L)_d, (M/L)_b`。
  - 単位: `r[kpc]`, `a[km^2 s^-2 kpc^-1]` と解釈。

## 実装/再現
- 依存: `numpy, scipy, pandas(任意), matplotlib(任意)`。
- 取得: `scripts/fetch_sparc.sh` をZenodo対応に更新。
- 主コード:
  - `src/fdb/models.py`（GR, FDB3）
  - `src/fdb/sparc.py`（rotmodローダ）
  - `scripts/fit_sparc_fdb3.py`（例: NGC3198/2403）
  - `scripts/fit_sparc_fdb3_all.py`（一括集計）
  - `scripts/global_fit_fdb3.py`（共有a,b,cの共同フィット）
  - `scripts/plot_sota_figs.py`（SOTA図の一括生成）

## 既知の限界/次改善
- 共同フィット(全銀河同時)ではない → 事前/正則化未導入。
- RJスペクトル比に基づく拘束未適用 → 過剰適合の恐れ。
- レンズ・団スケールへの外挿無し。

## 次アクション（提案）
1) RJ比を`a,b,c`へ弱事前として実装（階層ベイズ化）。
2) 全銀河同時フィットで`(a,b,c)`の共有/分布推定。
3) 交差検証: 学習/検証銀河分割で汎化評価。
4) FDBL(3D)のスケルトン実装→MaNGA質量分布で検証。
