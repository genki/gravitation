# 共有パラメータ検証(直交化+誤差下限) 実行ログ

- 実行日: 2025-08-29
- 目的: 1/r項直交化(`--inv1-orth`)と誤差下限(`--eg-frac-floor=0.15`)の導入効果をnearby/拡大20で検証。
- 背景: 外縁重み強化で1/rが大きく出る傾向の安定化・過適合抑制。

## 実行
- nearby (外縁重み1.5):
  - `PYTHONPATH=. .venv/bin/python scripts/compare_fit_multi.py \
     --names-file data/sparc/sets/nearby.txt --boost 0.5 --boost-tie-lam \
     --auto-geo --gas-scale-grid 1.0,1.33 --outer-weight 1.5 \
     --eg-frac-floor 0.15 --inv1-orth \
     --out data/results/multi_fit_nearby_outer1.5_orth_eg015.json`
- 拡大20:
  - `PYTHONPATH=. .venv/bin/python scripts/compare_fit_multi.py \
     --names-file data/sparc/sets/expanded20.txt --boost 0.5 --boost-tie-lam \
     --auto-geo --gas-scale-grid 1.0,1.33 \
     --eg-frac-floor 0.15 --inv1-orth \
     --out data/results/multi_fit_expanded20_orth_eg015.json`
- レポート再生成: `PYTHONPATH=. python scripts/build_report.py`

## 結果サマリ
- nearby(外縁1.5): 最良 `λ≈12 kpc, A≈316, gas=1.0`, 合計χ²(ULW) ≈ 380
  - 直交化前(外縁1.5): `χ² ≈ 5.71e3` → 大幅改善（重み/誤差下限の定義が異なるため絶対比較は参考値）。
- 拡大20: 最良 `λ≈15 kpc, A≈100, gas=1.33`, 合計χ²(ULW) ≈ 9.11e2

## 所見
- 直交化により1/rと星寄与の共線性が緩み、`alpha_line`が過大化せずに安定。
- 誤差下限0.15の導入で外縁/内縁の重みバランスが改善し、曲線形状の過適合が緩和。
- 近傍→拡大20で `λ` が 12→15kpc にシフト、`A` は100〜300帯に集約。サンプル拡大に対して一貫した範囲。

## 生成物
- JSON: `data/results/multi_fit_nearby_outer1.5_orth_eg015.json`,
        `data/results/multi_fit_expanded20_orth_eg015.json`
- HTML: `server/public/reports/multi_fit_nearby_outer1.5_orth_eg015.html`,
        `server/public/reports/multi_fit_expanded20_orth_eg015.html`

## 次アクション案
- SOTAの“代表比較図”を新最良の共有パラメータで再計算・固定表示（現状は最良AIC自動選択）。
- `outer-weight` を 1.0/1.5 で並列比較し、`ΔAIC`の頑健性を確認。
- 1/rの正則化長εについて感度走査（0.3/0.5/0.8kpc）。

