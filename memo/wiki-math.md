# GitHub Wiki で数式を正しくレンダリングするための実践メモ

## 基本ルール（最重要）
- **インライン数式**は `$...$` を使う。外側に空白を入れない・内側に余計な空白を入れない（例: `$R=\theta_E'c^2$`）。  
- **ブロック数式**は `$$` で囲み、前後に必ず空行を入れる。`$$` の直後・直前に文字を置かない。  
- **インラインで `$$` を使わない。** すべて `$...$` で書く。  
- **空白入りの `$ ... $` はレンダリングされない**ので避ける。  
- 画像 alt 内の LaTeX を誤検出する場合があるため、確認はテキスト本文（innerText）で行う。

## 記号・エスケープのこつ
- 単位や指数は `$s^{-1}$` のようにまとめて書く。`[$\mathrm{s}^{-1}$]` のように角括弧ごと数式に含めると安全。  
- 下線 `_` を含む識別子は GitHub Wiki ではそのまま `$A_{\rm FDB}$` でOK（Markdown の `_` 強調と衝突しない）が、エラー検出を減らしたい場合は `\_` としてもよい。  
- ギリシャ文字単独の説明で誤検出される場合は、文言を「σ軸」のようにプレーンテキストにする手も有効。

## 典型パターン（OK例）
- インライン: `$R=\theta_E' c^2/(2\pi v_c^2)$`
- ブロック:
  ```

  $$
  I_{\mu\nu}(x)=\kappa (P_{\rm TT})_{\mu\nu}{}^{\alpha\beta}
    \int d^4x'\, G_{\rm front}(x,x')\, T^{\rm (mat)}_{\alpha\beta}(x')
  $$

  ```

## よくあるNG
- `$ R = ... $` （外側に空白）  
- `$R = ...$` （内部に先頭空白）  
- インラインで `$$...$$` を使う  
- ブロック前後に空行なし  
- `- $m_\chi ...` のように `$` の直前に記号を接続 → Markdown で箇条書き記号と衝突しやすい

## チェックツール（scripts/check-math.js）
- 使い方: `node scripts/check-math.js <wiki-url>`  
- 検査ポリシー:
  - ページの **innerText** を対象に `$` や `$$` が残存していないか確認（画像 alt の LaTeX は無視）。  
  - `mathcolor="red"` など MathJax エラーの出力も検出。  
  - `\frac{` が素のテキストとして残っていないか検出。  
  - `(\` を含む括弧付きLaTeX（例: `(\rho_\chi)`）も未レンダリング候補として拾う。
- これでエラーゼロになるまで修正するのが安全。

## 運用フロー（推奨）
1) 文章を編集する際は最初から上記ルールで記述。  
2) 編集後に `scripts/check-math.js` を実行し、未レンダリング箇所を潰す。  
3) 必要なら `curl ... | grep \\$` などで生 `$` の残存を二重チェック。  
4) Wiki に push して再度 `check-math` を回す（公開状態で確認）。  

## 参考
- 実際に問題になった事例と対処
  - ブロック数式の前後に空行がなく未レンダリング → 空行を追加。  
  - インラインで `$$` を使い検出 → `$...$` に置換。  
  - `$m_\chi` の前に箇条書きハイフンが接続しレンダリング失敗 → プレーンテキストに直すか文言を修正。  
  - 単位 `s^{-1}` を `[s$^{-1}$]` と書きエラー → `[$\mathrm{s}^{-1}$]` に統一。  

